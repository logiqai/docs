# Webhook Integration

Apica Alerts can be delivered to any service through a Custom Webhook Integration.

Custom Webhook Targets allow you to:

* Set up incident alerts to any system that supports HTTP(S)
* Create calls with multiple steps for both Trigger and Resolution of incidents
* Trigger multiple API calls to execute a set of actions

## Overview <a href="#overview" id="overview"></a>

1. **Important**: Define your Webhook Placeholders first
2. Add the Custom Target
3. **Note:** For delivery to work, there needs to exist a receiving **Webhook** to handle the request.

| **Step**                                                                                                                                                                                                                                                                                                                                                                    | **Screenshot**                                                                                                                                                                                                                 |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| <h3 id="add-webhook-target">Add WebHook Target</h3><ul><li>Locate the Webhook symbol which can be found next to any alarm recipient.</li><li>Click the symbol to start to <strong>Add WebHook Target</strong></li><li>A Service and Target Name dialog will appear at the bottom of the Recipient.</li><li>Select <strong>Custom</strong> from the drop-down box.</li></ul> | <div><figure><img src="../../../../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure></div><div><figure><img src="../../../../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure></div> |
| <h3 id="the-custom-webhook-target-dialog">The Custom Webhook Target Dialog</h3><p>The detailed steps for filling in this dialog box have their own page, Adding a Custom Service Target.</p>                                                                                                                                                                                | <p></p><p> <img src="../../../../.gitbook/assets/image (2).png" alt=""></p>                                                                                                                                                    |

## Adding a Custom Service Target <a href="#adding-a-custom-service-target" id="adding-a-custom-service-target"></a>

If your Webhook-enabled application is not listed (ServiceNow, OpsGenie, Slack, Splunk), you can easily create a custom Webhook target for delivering alerts to any predefined Webhook destination.

For each target/destination, there are options to send various alerts, in selected formats to them.

* PagerDuty
* Webhook
* Email
* SMS

In the following screenshot, the DocDemo Target/User has a few alerts now being sent to him, including a custom Webhook-enabled alert.

<figure><img src="../../../../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

The Webhook icon indicates the kind of alert it is.

You can also see the PagerDuty, SMS, and email alerts icons next to the names of the alerts.

## Steps to create a Custom Webhook Target <a href="#steps-to-create-a-custom-webhook-target" id="steps-to-create-a-custom-webhook-target"></a>

**Note:** Before starting, for Custom Webhook delivery to work, you need to have a working Webhook in your service.

| **Step**                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | **Screenshot**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p>Open image-20200715-125748.png<img src="blob:https://apica-kb.atlassian.net/a706f702-6e45-4b6e-88b1-3ac4be0121eb#media-blob-url=true&#x26;id=1729e753-f993-4aa5-b3c7-8cc5ad04c0ab&#x26;collection=contentId-2134052386&#x26;contextId=2134052386&#x26;mimeType=image%2Fpng&#x26;name=image-20200715-125748.png&#x26;size=13846&#x26;width=150&#x26;height=139&#x26;alt=" alt=""></p><p>Create a Custom Service Target by clicking the <strong>WebHook</strong> button</p> | <div><figure><img src="../../../../.gitbook/assets/image (4).png" alt=""><figcaption></figcaption></figure></div>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| A blank target is created                                                                                                                                                                                                                                                                                                                                                                                                                                                    | <div><figure><img src="../../../../.gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure></div>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **Select the Service**                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| <p>The <strong>Service</strong> section allows you to select the service type that we are going to send an alert to.</p><p>The service should already be established to send the Webhook to and the authentication for the webhook service to use should already be enabled.</p>                                                                                                                                                                                             | <ul><li>Open the <strong>Service</strong> menu</li></ul><div><figure><img src="../../../../.gitbook/assets/image (6).png" alt=""><figcaption></figcaption></figure></div><ul><li>Choose the <strong>Custom</strong> service</li></ul><div><figure><img src="../../../../.gitbook/assets/image (7).png" alt=""><figcaption></figcaption></figure></div>                                                                                                                                                                                                                                                                                                                                                                                                                  |
| The following steps refer to the following Custom Service dialog                                                                                                                                                                                                                                                                                                                                                                                                             | <div><figure><img src="../../../../.gitbook/assets/image (8).png" alt=""><figcaption></figcaption></figure></div>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| <h4 id="set-a-target-name">Set a Target Name</h4><p>The target name identifies the target in Synthetic Monitoring.</p><ul><li>Enter a <strong>Service Name</strong> for display.</li></ul><p><strong>Required!</strong> This field is required in Apica Synthetic. The exact contents of the field may depend on the requirements of your service.</p>                                                                                                                       | <h4 id="general-service-name">General - Service Name</h4><div><figure><img src="../../../../.gitbook/assets/image (9).png" alt=""><figcaption></figcaption></figure></div><p>In the <strong>Service Name</strong> section, you can provide the ID or name of the service that should receive the alerts.</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **Add Target Details**                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| <h4 id="set-authentication">Set Authentication</h4><p>Set your Authentication, including</p><ul><li>Basic Authentication</li><li>OAuth2</li></ul>                                                                                                                                                                                                                                                                                                                            | <h4 id="global-authentication">Global Authentication</h4><div><figure><img src="../../../../.gitbook/assets/image (10).png" alt=""><figcaption></figcaption></figure></div><p>In the <strong>Global Authentication</strong> section, you can choose and configure the type of authentication to use for alert delivery.</p>                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| <h4 id="request-headers">Request Headers</h4><p>Define the <a href="https://apica-kb.atlassian.net/wiki/spaces/ASMDOCS/pages/2134052386/Custom+Target+Webhook+Integration">HTTP Header</a> Type and value pairs to attach to different request types.</p>                                                                                                                                                                                                                    | <div><figure><img src="../../../../.gitbook/assets/image (11).png" alt=""><figcaption></figcaption></figure></div><p> </p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| <h4 id="request-types">Request Types</h4><p>Send the Service if the request is a Trigger, Resolution, Authentication, or a refreshed access token</p>                                                                                                                                                                                                                                                                                                                        | <p><strong>T</strong> (Trigger): Send this header when the alert triggers</p><p><strong>R</strong> (Resolve): Send this header when the alert resolves</p><p><strong>A</strong> (Authenticate): Authenticate using the access token.</p><p><strong>F</strong> (Refresh): Request with refresh token for a new access token.</p>                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| <h4 id="header-content">Header Content</h4><p>Multiple headers can be added by clicking the <strong>Add</strong> <img src="https://pf-emoji-service--cdn.us-east-1.prod.public.atl-paas.net/atlassian/productivityEmojis/add-32px.png" alt="Plus"> button</p>                                                                                                                                                                                                                | <p><strong>Name</strong>: The name of the header.</p><p><strong>Value</strong>: The value of the header.</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| <h4 id="response-parameters">Response Parameters</h4><p><strong>Example:</strong></p><p>A RESTful service has the <code>incident_id</code> parameter. This parameter should be saved for use when resolving the incident.</p><p>Multiple parameters can be added by clicking the <strong>Add</strong> button</p>                                                                                                                                                             | <div><figure><img src="../../../../.gitbook/assets/image (12).png" alt=""><figcaption></figcaption></figure></div><p>The <strong>Response Parameters</strong> section lets you define parameters in responses to store for use in future requests.</p><p><strong>XPath</strong>: The XPath for the parameter in the response.</p><p>Example: <code>/response/sessionKey</code>.</p><p><strong>Placeholder</strong>: A Webhook Placeholder to be replaced with the actual value.</p><p>Example: <code>#SESSION_KEY#</code></p><p><strong>Is Auth?</strong>: Indicates (1) if the parameter is used for authentication and (2) that the parameter has an expiration time. Any time the Alerter fails to authenticate, it will clean up all values for this parameter.</p> |
| <h4 id="trigger-sequence">Trigger Sequence</h4>                                                                                                                                                                                                                                                                                                                                                                                                                              | A procedure page on entering the **Trigger Request Sequence** configures the steps to begin a Webhook alert handling instance.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| <h4 id="resolve-sequence">Resolve Sequence</h4>                                                                                                                                                                                                                                                                                                                                                                                                                              | A procedure page on entering the **Trigger Resolve Sequence** configures the steps to begin a Webhook alert handling instance when the alert has been resolved. i.e. to notify when the situation has been corrected or the event has ended.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| <h4 id="done-add-custom-webhook-target">(Done) Add Custom Webhook Target</h4>                                                                                                                                                                                                                                                                                                                                                                                                | <p>When you are happy with all the settings, you can create the target.</p><p>Click the <strong>Add Custom WebHook Target</strong> button</p><div><figure><img src="../../../../.gitbook/assets/image (14).png" alt=""><figcaption></figcaption></figure></div><div><figure><img src="../../../../.gitbook/assets/image (15).png" alt=""><figcaption></figcaption></figure></div><div><figure><img src="../../../../.gitbook/assets/image (16).png" alt=""><figcaption></figcaption></figure></div>                                                                                                                                                                                                                                                                     |

## Trigger Sequence <a href="#trigger-sequence.1" id="trigger-sequence.1"></a>

### The Trigger Request Sequence <a href="#the-trigger-request-sequence" id="the-trigger-request-sequence"></a>

This **Trigger Request Sequence** configures the steps to begin a Webhook alert handling instance. Basically,

* What _service_ do you want to send a Webhook to?
* What _information_ do you want to send to that service?
* Under what _Severity_ condition do you want to send it?
* Confirmation: Do you want to send HTTP requests to the application to see if it returns an expected response?
  * Do you want this to repeat? If so, under what conditions should it stop repeating?

<figure><img src="../../../../.gitbook/assets/image (17).png" alt=""><figcaption></figcaption></figure>

| **Step**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | **Screenshot**                                                                                                                                                                                                       |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <h3 id="id-1.-define-the-trigger-url">1. Define the Trigger URL</h3><p>What Webhook-enabled <strong>Trigger URL</strong> field is Apica going to use to trigger the alert? It will send one of the selected Methods to this URL.</p><ul><li>Trigger URL is the URL to Access</li><li><p>Method: HTTP Methods to use for calling the authentication server.</p><ul><li><code>POST</code>/<code>GET</code>/<code>PUT</code>/<code>DELETE</code>/<code>PATCH</code></li></ul></li></ul>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | <div><figure><img src="../../../../.gitbook/assets/image (18).png" alt=""><figcaption></figcaption></figure></div>                                                                                                   |
| <h3 id="id-2.-add-the-webhook-payload-for-the-alert-target">2. Add the Webhook Payload for the Alert Target</h3><p>You can specify a content type in the Payload section to include as a payload for the trigger request.</p><p><strong>Content-Type:</strong> The MIME Type for the data.</p><p><code>application/json / www-form-urlencoded</code></p><p><strong>Data:</strong> Payload content.</p><ul><li>The data field defines the message content for the payload.</li><li>You may use Message Placeholders in the data.</li></ul><p><strong>Severity:</strong> A combination of Severity indicators.</p><ul><li><p>The severity field lets you select which severity type(s) to attach to the alert.</p><ul><li><strong>F</strong>: Fatal</li><li><strong>E</strong>: Error</li><li><strong>W</strong>: Warning</li></ul></li></ul>                                                                                                                                                                        | <div><figure><img src="../../../../.gitbook/assets/image (19).png" alt=""><figcaption></figcaption></figure></div><p> </p>                                                                                           |
| <h4 id="data-payload-example-01">Data Payload Example 01</h4>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | <p>A string containing key-value pairs for the content.</p><p><code>username=user&#x26;title=Resolved Alert!</code></p><p>{<code>"message": "%SEV% Resolved Alert for check '%CHECK_NAME%' at %TT%: %M%"</code>}</p> |
| <h4 id="data-payload-example-02">Data Payload Example 02</h4>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | <p>A simple alert text string:</p><p><code>Resolved! Notification of a Resolved Error</code></p>                                                                                                                     |
| <h3 id="id-3.-add-sub-requests-as-needed">3. Add Sub Requests As Needed</h3><p>You can add additional URL calls to the request sequence in the Sub Requests section.</p><ul><li>Some services require more than one call to their REST API to trigger an alert event.</li><li>Multiple sub-requests can be added by clicking the <strong>Add</strong> button</li></ul><p><strong>URL:</strong> URL to access.</p><p><strong>Method:</strong> HTTP Methods to use for calling the authentication server.</p><ul><li><code>POST/GET/PUT/DELETE/PATCH</code></li></ul><p><strong>Repeat:</strong> Indicates if the call should be repeated until the Condition expression is matched.</p><p><strong>Condition:</strong> An <a href="https://apica-kb.atlassian.net/wiki/spaces/ASMDOCS/pages/2134052386/Custom+Target+Webhook+Integration">XPath</a> expression representing the condition to match when the <strong>Repeat</strong> checkbox is marked.</p><p><em>Example</em>: <code>/data/success=true</code>.</p> | <div><figure><img src="../../../../.gitbook/assets/image (20).png" alt=""><figcaption></figcaption></figure></div><p> </p><p> </p>                                                                                   |
| <h3 id="id-4.-add-if-sub-requests-repeat-and-if-they-have-a-repeat-condition">4. Add if Sub Requests Repeat</h3><p>Checking the <strong>Repeat</strong> box setting makes the subrequest step repeat until a <strong>Condition</strong> is met.</p><p>When you want to do this, you need to set repeat on so a GET will be issued until the desired response is collected.</p><p><strong>Note:</strong> The condition needs to be an XPath expression indicating the response's desired value.</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | <p></p><p> <img src="../../../../.gitbook/assets/image (21).png" alt=""></p>                                                                                                                                         |
| <h3 id="id-5.-add-headers">5. Add Headers</h3><p>You can define an HTTP Header in the Headers section to attach to the subrequest. </p><p><strong>Name:</strong> The name of the header.</p><p><strong>Value:</strong> The value of the header.</p><p>Multiple headers for each sub-request can be added by clicking the green <strong>Add</strong> button.</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | <div><figure><img src="../../../../.gitbook/assets/image (22).png" alt=""><figcaption></figcaption></figure></div>                                                                                                   |

## Resolve Sequence (Optional) <a href="#resolve-sequence-optional" id="resolve-sequence-optional"></a>

## The Resolve Request Sequence (Optional) <a href="#the-resolve-request-sequence-optional" id="the-resolve-request-sequence-optional"></a>

<figure><img src="../../../../.gitbook/assets/image (23).png" alt=""><figcaption></figcaption></figure>

This **Resolve Request Sequence** configures the steps to begin a follow-up Webhook alert handling instance to handle a resolution. Basically: this allows a service to handle a resolution of an earlier Trigger alert.

_**This is an optional Sequence.**_ If you only want your receiving service to handle the resolve, you do **not** need to add a resolve request.

It asks for most of the same information as in the Trigger Sequence except without a Severity.

* What _service_ do you want to send a Webhook to?
* What _information_ do you want to send to that service?
* Confirmation: Do you want to send HTTP requests to the application to see if it returns an expected response?
  * Do you want this to repeat? If so, under what conditions should it stop repeating?

| **Step**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | **Screenshot**                                                                                                                                                                                                                                       |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <h3 id="id-1.-define-the-resolve-url">1. Define the Resolve URL</h3><p>What Webhook-enabled <strong>Resolve URL</strong> field is Apica going to use to stop the alert? It will send one of the selected Methods to this URL.</p><ul><li>The Resolve URL is the URL to Access</li><li><p>Method: HTTP Methods to use for calling the authentication server.</p><ul><li><code>POST</code>/<code>GET</code>/<code>PUT</code>/<code>DELETE</code>/<code>PATCH</code></li></ul></li></ul>                                                                                                                                                                                                                                                                                                                                                                                                                   | <div><figure><img src="../../../../.gitbook/assets/image (24).png" alt=""><figcaption></figcaption></figure></div><p> </p>                                                                                                                           |
| <h3 id="id-2.-add-the-webhook-payload-for-the-alert-target.1">2. Add the Webhook Payload for the Alert Target</h3><p>You can specify a content type in the Payload section to include as a payload for the resolve request.</p><p><strong>Content-Type:</strong> The MIME Type for the data.</p><p><code>application/json / www-form-urlencoded</code></p><p><strong>Data:</strong> Payload content.</p><ul><li>The data field defines the message content for the payload.</li><li>You may use Message Placeholders in the data.</li></ul>                                                                                                                                                                                                                                                                                                                                                             | <div><figure><img src="../../../../.gitbook/assets/image (25).png" alt=""><figcaption></figcaption></figure></div>                                                                                                                                   |
| <h4 id="data-payload-example-01.1">Data Payload Example 01</h4>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | <p>A string containing key-value pairs for the content.</p><p><code>username=user&#x26;title=Alert!</code></p><p>{<code>"message": "%SEV% alert for check '%CHECK_NAME%' at %TT%: %M%"</code>}</p>                                                   |
| <h4 id="data-payload-example-02.1">Data Payload Example 02</h4>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | <p>A simple alert text string:</p><p><code>Alert! Notification of an Error</code></p>                                                                                                                                                                |
| <h3 id="id-3.-set-resolve-sub-requests-as-needed">3. Set Resolve Sub Requests As Needed</h3><p>You can add additional URL calls to the request sequence in the Sub Requests section. Some services require more than one call to their REST API to resolve an alert event.</p><ul><li>Multiple sub-requests can be added by clicking the <strong>Add</strong> button.</li></ul><p><strong>URL:</strong> URL to access.</p><p><strong>Method:</strong> HTTP Methods to use for calling the authentication server.</p><ul><li><code>POST/GET/PUT/DELETE/PATCH</code></li></ul><p><strong>Repeat:</strong> Indicates if the call should be repeated until the Condition expression is matched.</p><p><strong>Condition:</strong> An XPath expression representing the condition to match when the <strong>Repeat</strong> checkbox is marked.</p><p><em>Example</em>: <code>/data/success=true</code>.</p> | <div><figure><img src="../../../../.gitbook/assets/image (26).png" alt=""><figcaption></figcaption></figure></div><p> </p><div><figure><img src="../../../../.gitbook/assets/image (27).png" alt=""><figcaption></figcaption></figure></div><p> </p> |
| <h3 id="id-4.-add-if-sub-requests-repeat-and-if-they-have-a-repeat-condition.1">4. Add if Sub Requests Repeat and if they have a Repeat Condition</h3><p>Checking the <strong>Repeat</strong> box setting makes the subrequest step repeat until a <strong>Condition</strong> is met.</p><p>When you want to do this, you need to set repeat on so a GET will be issued until the desired response is collected.</p><p><strong>Note:</strong> The condition needs to be an XPath expression indicating the response's desired value.</p>                                                                                                                                                                                                                                                                                                                                                                | <div><figure><img src="../../../../.gitbook/assets/image (28).png" alt=""><figcaption></figcaption></figure></div>                                                                                                                                   |
| <h3 id="id-5.-send-sub-request-headers">5. Send Sub Request Headers</h3><p>You can define an HTTP Header in the Headers section to attach to the subrequest. </p><p><strong>Name</strong> The name of the header.</p><p><strong>Value:</strong> The value of the header.</p><p>Multiple headers for each sub-request can be added by clicking the green <strong>Add</strong> button.</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | <div><figure><img src="../../../../.gitbook/assets/image (29).png" alt=""><figcaption></figcaption></figure></div>                                                                                                                                   |

## Custom Webhook Examples <a href="#custom-webhook-examples" id="custom-webhook-examples"></a>

### Custom Webhook w/ message placeholder (Microsoft Teams) <a href="#custom-webhook-w-message-placeholder-microsoft-teams" id="custom-webhook-w-message-placeholder-microsoft-teams"></a>

For instructions on setting up the URL which will be used as both the “Trigger URL” and the “Resolution URL”, refer to the official Microsoft documentation [here](https://docs.microsoft.com/en-us/microsoftteams/platform/webhooks-and-connectors/how-to/add-incoming-webhook).

Open Screen Shot 2022-08-17 at 4.08.12 PM.png![](blob:https://apica-kb.atlassian.net/3b61be95-d6ff-4fbd-9206-36ddb8920d93#media-blob-url=true\&id=2d4415de-957f-4258-855f-6a9ef3c9afca\&collection=contentId-2134052386\&contextId=2134052386\&mimeType=image%2Fpng\&name=Screen%20Shot%202022-08-17%20at%204.08.12%20PM.png\&size=641579\&width=830\&height=775\&alt=)Open Screen Shot 2022-08-17 at 4.08.48 PM.png![](blob:https://apica-kb.atlassian.net/2a16e509-da0d-480f-8fae-92c42cd2bf90#media-blob-url=true\&id=65dc278a-757c-42ad-888c-b5b8fac7843b\&collection=contentId-2134052386\&contextId=2134052386\&mimeType=image%2Fpng\&name=Screen%20Shot%202022-08-17%20at%204.08.48%20PM.png\&size=102225\&width=720\&height=418\&alt=)

**Trigger URL:** [https://apicasystem.webhook.office.com/webhookb2/{longGuidString}](https://apicasystem.webhook.office.com/webhookb2/%7BlongGuidString%7D) /IncomingWebhook/{longGuidString}

**Resolution URL:** [https://apicasystem.webhook.office.com/webhookb2/{longGuidString}](https://apicasystem.webhook.office.com/webhookb2/%7BlongGuidString%7D) /IncomingWebhook/{longGuidString}

**Data:** For both the trigger and resolution request sequences, the placeholder %CHECK\_ID% is used along with a custom message to inform the user that the alert has been triggered/resolved.

&#x20;

Example alert trigger/resolution within a configured Microsoft Teams channel:

Open Screen Shot 2022-08-17 at 4.17.29 PM.png![](blob:https://apica-kb.atlassian.net/c8781a4c-f685-4ec2-a9dc-01dea59a8ed1#media-blob-url=true\&id=cda2e206-d202-4242-915a-e5beed82c90f\&collection=contentId-2134052386\&contextId=2134052386\&mimeType=image%2Fpng\&name=Screen%20Shot%202022-08-17%20at%204.17.29%20PM.png\&size=232950\&width=1012\&height=295\&alt=)

### Custom Webhook w/ message placeholder (OpsGenie) <a href="#custom-webhook-w-message-placeholder-opsgenie" id="custom-webhook-w-message-placeholder-opsgenie"></a>

Open Screen Shot 2022-08-01 at 12.35.44 PM.png![](blob:https://apica-kb.atlassian.net/46813555-df88-4eab-bdd1-4bffad079ef6#media-blob-url=true\&id=f7652ee4-a1a3-462e-971e-01b4f3881d47\&collection=contentId-2134052386\&contextId=2134052386\&mimeType=image%2Fpng\&name=Screen%20Shot%202022-08-01%20at%2012.35.44%20PM.png\&size=652082\&width=834\&height=815\&alt=)Open Screen Shot 2022-08-01 at 12.41.21 PM.png![](blob:https://apica-kb.atlassian.net/8d1bb6c8-2dd6-4c6b-a831-1ee6ff8515f8#media-blob-url=true\&id=44f2d7f8-7e4e-4f52-9602-7c52c33fb31a\&collection=contentId-2134052386\&contextId=2134052386\&mimeType=image%2Fpng\&name=Screen%20Shot%202022-08-01%20at%2012.41.21%20PM.png\&size=218320\&width=720\&height=331\&alt=)

**Trigger URL:** [https://api.opsgenie.com/v2/alerts?apiKey={opsGenieApiKey}](https://api.opsgenie.com/v2/alerts?apiKey=%7bopsGenieApiKey%7d) (opsGenieApiKey is generated on the OpsGenie end)

**Data:**

`{ "message":"%CHECK_NAME%", "alias":"%CHECK_ID%", "description":"%CHECK_DESCRIPTION%", "responders":[ { "name":"SAT", "type":"team" } ], "visibleTo":[ { "name":"SAT", "type":"team" } ], "priority":"P1", "user":"ASM" }`

This JSON data is an example which we’ve created based on your current OpsGenie integration. The payload can be customized by referring to this documentation: [![](https://files.readme.io/024c9aa-favicon.ico)Alert API](https://docs.opsgenie.com/docs/alert-api#create-alert)

%CHECK\_NAME%, %CHECK\_ID%, and %CHECK\_DESCRIPTION% are message placeholders. Alias must be %CHECK\_ID% in order for the resolution request to function correctly.

**Resolve URL:** [https://api.opsgenie.com/v2/alerts/%CHECK\_ID%/close?identifierType=alias\&apiKey={opsGenieApiKey}](https://api.opsgenie.com/v2/alerts/%CHECK_ID%/close?identifierType=alias\&apiKey=%7bopsGenieApiKey%7d) (opsGenieApiKey is generated on the OpsGenie end)

%CHECK\_ID% is a string which dynamically grabs the check ID of the check, which has ALSO been set as the Alias of the alert. It is possible to close Alerts via alert Alias, which we defined to be the Check ID in the Trigger Sequence request body. Thus, by specifying the Check ID as both the alias of the alert, we are able to dynamically identify and close the alert we created before. “identifierType=alias” is required.

**Data (resolution request):**

`{“user”:”ASM”}`

The response body of the resolution alert cannot be empty. Thus, at least one property must be present in the JSON body, although the POST call does not require any data from the OpsGenie end. It is possible to add a resolution note as well; see [![](https://files.readme.io/024c9aa-favicon.ico)Alert API](https://docs.opsgenie.com/docs/alert-api#close-alert) for more details concerning closing alerts.

### Custom Webhook w/ message placeholder, custom webhook placeholders (Slack) <a href="#custom-webhook-w-message-placeholder-custom-webhook-placeholders-slack" id="custom-webhook-w-message-placeholder-custom-webhook-placeholders-slack"></a>

Open Screen Shot 2022-07-29 at 10.44.54 AM.png![](blob:https://apica-kb.atlassian.net/38231e3c-3ab4-4c2c-9220-ad0557c206e5#media-blob-url=true\&id=e9310ca2-323e-47d3-86b1-327d223db561\&collection=contentId-2134052386\&contextId=2134052386\&mimeType=image%2Fpng\&name=Screen%20Shot%202022-07-29%20at%2010.44.54%20AM.png\&size=743646\&width=831\&height=871\&alt=)Open Screen Shot 2022-08-01 at 12.49.21 PM.png![](blob:https://apica-kb.atlassian.net/66c35a08-7093-472c-9925-b3ddf09e1de1#media-blob-url=true\&id=3c9bc30a-b411-46a7-a316-67a659a5f0d5\&collection=contentId-2134052386\&contextId=2134052386\&mimeType=image%2Fpng\&name=Screen%20Shot%202022-08-01%20at%2012.49.21%20PM.png\&size=327422\&width=714\&height=475\&alt=)

**Response Parameters:** although the UI asks for the XPath for finding XML, it is also capable of finding JSON properties with the XPath. In this instance, we want to capture the value of the URL property of the HTTP response of our Sub Request (the [api-wpm.apicasystem.com](http://api-wpm.apicasystem.com/) request).

As such, we will use #url# to display the “url” property of the api-wpm API call in our resolution message.

**Trigger Request:** the initial API call we make when the Alert is Triggered. Generated from the Slack end. Example: [https://hooks.slack.com/services/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](https://hooks.slack.com/services/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)

**Data:** Note that the data contains a [Message Placeholder](https://apica-kb.atlassian.net/wiki/pages/createpage.action?spaceKey=AM\&title=New%3A%20Message%20Placeholders), %CHECK\_NAME%, which allows us to display dynamic data in the Slack message body.

**Severity**: We can have different Payload data (that is, different request messages) for different severities if we so desire. That is not needed for our use case, so we will use one payload for Warning, Error, and Fatal.

**Sub Requests:** After the initial request to [https://hooks.slack.com](https://hooks.slack.com/) is made, we want to get ADDITIONAL information about the check from an API call which gives us more check data. We store that data in the Response Parameter we explained above. Example: [https://api-asm-eu1.apica.io/v3/checks/{check\_id}?auth\_ticket=](https://api-asm-eu1.apica.io/v3/checks/2160516?auth_ticket=8A740A98-10F6-491D-B966-E662E723329F){auth\_ticket}

**Resolution Request:** the final API call we make when the Alert is Resolved. Note the usage of both Message and Webhook placeholders to give our resolution message that dynamic data we need. Generated from the Slack end. Example: [https://hooks.slack.com/services/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](https://hooks.slack.com/services/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)

Here are examples of the request/resolution messages that are sent to Slack based on the above configuration:

Open Screen Shot 2022-07-15 at 4.45.26 PM.png![](blob:https://apica-kb.atlassian.net/bee1a945-e9d8-40e4-9700-f2f893ea0ae1#media-blob-url=true\&id=15e7d856-1ea5-48e2-9b14-e64ecc871de4\&collection=contentId-2134052386\&contextId=2134052386\&mimeType=image%2Fpng\&name=Screen%20Shot%202022-07-15%20at%204.45.26%20PM.png\&size=119025\&width=642\&height=84\&alt=)[custom](https://apica-kb.atlassian.net/wiki/label/ASMDOCS/custom)[webhook](https://apica-kb.atlassian.net/wiki/label/ASMDOCS/webhook)[targets](https://apica-kb.atlassian.net/wiki/label/ASMDOCS/targets)[\
](https://apica-kb.atlassian.net/wiki/label/ASMDOCS/alerts)
